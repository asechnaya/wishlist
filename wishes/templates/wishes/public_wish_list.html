{% extends "base.html" %}

{% block title %}{{ owner.username }} — Public wishlist{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto">
  <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6">
    <h1 class="text-2xl font-bold">
      {{ owner.username }}’s public wishlist
    </h1>

    <form method="get" class="flex items-center gap-2">
      <input
        type="text"
        name="q"
        value="{{ q }}"
        placeholder="Search wishes..."
        class="border rounded px-3 py-2 w-64"
      />
      {# Preserve tag when searching #}
      {% if selected_tag %}
        <input type="hidden" name="tag" value="{{ selected_tag }}">
      {% endif %}
      <button type="submit" class="button">Search</button>
      {% if q or selected_tag %}
        <a href="{% url 'public_wish_list' owner.username %}" class="text-sm text-gray-500 hover:underline">Reset</a>
      {% endif %}
    </form>
  </div>

  {# Tag filters #}
  {% if tag_facets %}
    <div class="flex flex-wrap items-center gap-2 mb-6">
      <a
        href="{% url 'public_wish_list' owner.username %}{% if q %}?q={{ q|urlencode }}{% endif %}"
        class="px-3 py-1 rounded border {% if not selected_tag %}bg-gray-900 text-white{% else %}bg-white{% endif %}"
      >
        All
      </a>
      {% for tag in tag_facets %}
        <a
          href="{% url 'public_wish_list' owner.username %}?tag={{ tag.name|urlencode }}{% if q %}&q={{ q|urlencode }}{% endif %}"
          class="px-3 py-1 rounded border {% if selected_tag == tag.name %}bg-gray-900 text-white{% else %}bg-white{% endif %}"
          title="{{ tag.name }}"
        >
          {{ tag.name }} <span class="text-gray-500">({{ tag.total }})</span>
        </a>
      {% endfor %}
    </div>
  {% endif %}

  {# Grid of wishes #}
  {% if page_obj.object_list %}
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
      {% for wish in page_obj.object_list %}
        {# render wish card #}
      {% empty %}
        <p>No wishes found.</p>
      {% endfor %}
    </div>
  {% else %}
    <div class="text-center text-gray-600 py-16">
      No wishes found{% if selected_tag %} for tag “{{ selected_tag }}”{% endif %}{% if q %} matching “{{ q }}”{% endif %}.
    </div>
  {% endif %}

  {# Pagination #}
  {% if page_obj.paginator.num_pages > 1 %}
    <nav class="flex items-center justify-center gap-2 mt-8" aria-label="Pagination">
      {% if page_obj.has_previous %}
        <a
          class="px-3 py-1 border rounded"
          href="?page={{ page_obj.previous_page_number }}{% if selected_tag %}&tag={{ selected_tag|urlencode }}{% endif %}{% if q %}&q={{ q|urlencode }}{% endif %}"
        >Prev</a>
      {% endif %}

      {% for num in page_obj.paginator.page_range %}
        {% if num == page_obj.number %}
          <span class="px-3 py-1 border rounded bg-gray-900 text-white">{{ num }}</span>
        {% elif num <= 2 or num > page_obj.paginator.num_pages|add:"-2" or num >= page_obj.number|add:"-1" and num <= page_obj.number|add:"1" %}
          <a
            class="px-3 py-1 border rounded"
            href="?page={{ num }}{% if selected_tag %}&tag={{ selected_tag|urlencode }}{% endif %}{% if q %}&q={{ q|urlencode }}{% endif %}"
          >{{ num }}</a>
        {% elif forloop.first or forloop.last %}
          <span class="px-3 py-1">…</span>
        {% endif %}
      {% endfor %}
    </nav>
  {% endif %}
</div>
{% endblock %}